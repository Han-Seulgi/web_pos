IP: 192.168.0.137
ID: team_3
PW: 3333

/* [ JS Framework를 활용한 Smart Web 개발자 ] */
/* 구현기능
   -- T : LANDING 
   -- T : 로그인
   -- T : 로그아웃
   -- P : 관리페이지 >> 대표, 매니저 접근가능 >> 직원등록 및 수정, 상품등록 및 수정
   -- P : 통계페이지 >> 대표만 접근 가능 >> 금월 직원의 출퇴근 기록을 일단위로 조회, 금월의 일단위 매출 및 영업이익 조회
   -- P : 판매페이지 >> 대표, 매니저, 아르바이트 접근가능 >> 주문을 위한 상품 검색 및 주문 등록, 회원 주문을 위한 포인트 등록
*/

/* 아래의 테이블 스크립트를 활용할 계정과 DATABASE는 팀별로 구축할시오.
   TABLE LIST 
   1. EMPLOYEES TABLE
   2. MEMBERS TABLE
   3. GOODS TABLE
   4. ORDERS TABLE
   5. ORDERSDETAILS TABLE
   6. POINTS TABLE
   7. ACCESSHISTORY TABLE
   8. CATEGORYITEM TABLE
*/

-- 8. CATEGORYITEM(SYNONYM : CGI)
CREATE TABLE CATEGORYITEM(
  CGI_CODE   NCHAR(2)        NOT NULL,
  CGI_NAME   NVARCHAR2(20)   NOT NULL
)TABLESPACE USERS;
  -- CONSTRAINTS
  ALTER TABLE CATEGORYITEM
  ADD CONSTRAINT CGI_CODE_PK     PRIMARY KEY(CGI_CODE);
  
  -- SYNONYM
  CREATE PUBLIC SYNONYM CGI FOR CATEGORYITEM;

  -- DATA
  INSERT INTO CGI(CGI_CODE, CGI_NAME) VALUES('PR', '대표');
  INSERT INTO CGI(CGI_CODE, CGI_NAME) VALUES('MA', '매니저');
  INSERT INTO CGI(CGI_CODE, CGI_NAME) VALUES('AR', '아르바이트');
  INSERT INTO CGI(CGI_CODE, CGI_NAME) VALUES('GB', '음료');
  INSERT INTO CGI(CGI_CODE, CGI_NAME) VALUES('GF', '농축산물');
  INSERT INTO CGI(CGI_CODE, CGI_NAME) VALUES('GS', '과자류');
  INSERT INTO CGI(CGI_CODE, CGI_NAME) VALUES('GG', '식자재');
  INSERT INTO CGI(CGI_CODE, CGI_NAME) VALUES('GI', '인스턴트');
  INSERT INTO CGI(CGI_CODE, CGI_NAME) VALUES('OS', '주문진행중');
  INSERT INTO CGI(CGI_CODE, CGI_NAME) VALUES('OP', '포인트적립중');
  INSERT INTO CGI(CGI_CODE, CGI_NAME) VALUES('OC', '주문완료');

  
-- 1. EMPLOYEES(SYNONYM : EMP)
CREATE TABLE EMPLOYEES(
  EMP_CODE      NCHAR(5)        NOT NULL,
  EMP_PASSWORD  NVARCHAR2(50)   NOT NULL,
  EMP_NAME      NVARCHAR2(5)    NOT NULL,
  EMP_HIREDATE  DATE            NOT NULL,
  EMP_LEVEL     NCHAR(2)        NOT NULL
)TABLESPACE USERS;

  -- CONSTRAINTS
  ALTER TABLE EMPLOYEES 
  ADD CONSTRAINT EMP_CODE_PK    PRIMARY KEY(EMP_CODE)
  ADD CONSTRAINT EMP_LEVEL_FK   FOREIGN KEY(EMP_LEVEL) REFERENCES CATEGORYITEM(CGI_CODE);
  
  -- SYNONYM
  CREATE PUBLIC SYNONYM EMP FOR EMPLOYEES;
  
  -- DATA : 대표자의 코드는 '0000'+팀번호 패스워드는 팀번호로 네자리 반복, 대표자명은 팀번호+'TEAM'  입사일은 '20220623'
  INSERT INTO EMP(EMP_CODE, EMP_PASSWORD, EMP_NAME, EMP_HIREDATE, EMP_LEVEL) 
  VALUES('00003', '3333', '3TEAM', TO_DATE('20220623', 'YYYYMMDD'), 'PR');
  INSERT INTO EMP(EMP_CODE, EMP_PASSWORD, EMP_NAME, EMP_HIREDATE, EMP_LEVEL) 
  VALUES('30000', '3333', '김매니', TO_DATE('20220623', 'YYYYMMDD'), 'MA');
  INSERT INTO EMP(EMP_CODE, EMP_PASSWORD, EMP_NAME, EMP_HIREDATE, EMP_LEVEL) 
  VALUES('30001', '3333', '이알바', TO_DATE('20220623', 'YYYYMMDD'), 'AR');
  
-- 7. ACCESSHISTORY(SYNONYM : AHT)
CREATE TABLE ACCESSHISTORY(
  AHT_EMPCODE   NCHAR(5)    NOT NULL,
  AHT_DATE      DATE        DEFAULT SYSDATE NOT NULL,
  AHT_ACTION    NUMBER(1,0) NOT NULL
)TABLESPACE USERS;

  -- CONSTRAINTS
  ALTER TABLE ACCESSHISTORY
  ADD CONSTRAINT AHT_EMPCODE_DATE_ACTION_PK PRIMARY KEY(AHT_EMPCODE, AHT_DATE, AHT_ACTION)
  ADD CONSTRAINT AHT_EMPCODE_FK FOREIGN KEY(AHT_EMPCODE) REFERENCES EMPLOYEES(EMP_CODE);
  
  -- SYNONYM
  CREATE PUBLIC SYNONYM AHT FOR ACCESSHISTORY;
  
  -- DATA
  
  
-- 2. MEMBERS(MEM)
CREATE TABLE MEMBERS(
  MEM_CODE      NCHAR(5)        NOT NULL,
  MEM_NAME      NVARCHAR2(5)    NOT NULL,
  MEM_PHONE     NVARCHAR2(11)   DEFAULT 'NONE'
)TABLESPACE USERS;

  -- CONSTRAINTS
  ALTER TABLE MEMBERS
  ADD CONSTRAINT MEM_CODE_PK    PRIMARY KEY(MEM_CODE);
  
  -- SYNONYM
  CREATE PUBLIC SYNONYM MEM FOR MEMBERS;
  
  -- DATA
  INSERT INTO MEM(MEM_CODE,MEM_NAME,MEM_PHONE) VALUES('11111', '한소희', '01011112222');
  INSERT INTO MEM(MEM_CODE,MEM_NAME,MEM_PHONE) VALUES('22222', '서강준', '01033334444');
  
-- 3. GOODS(GOO) : 상품코드 = 대표자코드+CGICODE+일련번호3자리
CREATE TABLE GOODS(
  GOO_CODE      NCHAR(10)       NOT NULL,
  GOO_NAME      NVARCHAR2(50)   NOT NULL,
  GOO_COST      NUMBER(7,0)     NOT NULL,
  GOO_PRICE     NUMBER(7,0)     NOT NULL,
  GOO_STOCK     NUMBER(3,0)     NOT NULL,
  GOO_CGICODE   NCHAR(2)        NOT NULL
)TABLESPACE USERS;

  -- CONSTRAINTS
  ALTER TABLE GOODS
  ADD CONSTRAINT GOO_CODE_PK    PRIMARY KEY(GOO_CODE)
  ADD CONSTRAINT GOO_CGICODE_FK FOREIGN KEY(GOO_CGICODE) REFERENCES CATEGORYITEM(CGI_CODE);
  
  -- SYNONYM
  CREATE PUBLIC SYNONYM GOO FOR GOODS;
  
  -- DATA
INSERT INTO GOO(GOO_CODE, GOO_NAME, GOO_COST, GOO_PRICE, GOO_STOCK, GOO_CGICODE) VALUES ('00003GB001', '솔의눈', '150', '1100', '999', 'GB');
INSERT INTO GOO(GOO_CODE, GOO_NAME, GOO_COST, GOO_PRICE, GOO_STOCK, GOO_CGICODE) VALUES ('00003GF001', '상추', '270', '2500', '999', 'GF');
INSERT INTO GOO(GOO_CODE, GOO_NAME, GOO_COST, GOO_PRICE, GOO_STOCK, GOO_CGICODE) VALUES ('00003GS001', '오징어땅콩', '350', '2700', '999', 'GS');
INSERT INTO GOO(GOO_CODE, GOO_NAME, GOO_COST, GOO_PRICE, GOO_STOCK, GOO_CGICODE) VALUES ('00003GG001', '고추장 1.8KG', '9800', '32000', '999', 'GG');
INSERT INTO GOO(GOO_CODE, GOO_NAME, GOO_COST, GOO_PRICE, GOO_STOCK, GOO_CGICODE) VALUES ('00003GI001', '3분카레', '320', '3200', '999', 'GI');

INSERT INTO GOO(GOO_CODE, GOO_NAME, GOO_COST, GOO_PRICE, GOO_STOCK, GOO_CGICODE) VALUES ('00003GB002', '밀키스', '1800', '2200', '100', 'GB');
INSERT INTO GOO(GOO_CODE, GOO_NAME, GOO_COST, GOO_PRICE, GOO_STOCK, GOO_CGICODE) VALUES ('00003GS002', '옥수수깡', '1000 ', '1200', '10', 'GS');
INSERT INTO GOO(GOO_CODE, GOO_NAME, GOO_COST, GOO_PRICE, GOO_STOCK, GOO_CGICODE) VALUES ('00003GF002', '복숭아', '20000', '28000', '30', 'GF');
INSERT INTO GOO(GOO_CODE, GOO_NAME, GOO_COST, GOO_PRICE, GOO_STOCK, GOO_CGICODE) VALUES ('00003GG002', '물엿', '5000', '5500', '100', 'GG');
INSERT INTO GOO(GOO_CODE, GOO_NAME, GOO_COST, GOO_PRICE, GOO_STOCK, GOO_CGICODE) VALUES ('00003GI002', '짜파구리컵-소', '1000', '1500', '50', 'GI');

INSERT INTO GOO(GOO_CODE, GOO_NAME, GOO_COST, GOO_PRICE, GOO_STOCK, GOO_CGICODE) VALUES ('00003GB003', '콜라', '1500', '2000', '10', 'GB');
INSERT INTO GOO(GOO_CODE, GOO_NAME, GOO_COST, GOO_PRICE, GOO_STOCK, GOO_CGICODE) VALUES ('00003GF003', '사과', '2500', '3000', '10', 'GF');
INSERT INTO GOO(GOO_CODE, GOO_NAME, GOO_COST, GOO_PRICE, GOO_STOCK, GOO_CGICODE) VALUES ('00003GS003', '초코파이', '1500', '2000', '10', 'GS');
INSERT INTO GOO(GOO_CODE, GOO_NAME, GOO_COST, GOO_PRICE, GOO_STOCK, GOO_CGICODE) VALUES ('00003GG003', '오이', '1000', '1500', '10', 'GG');
INSERT INTO GOO(GOO_CODE, GOO_NAME, GOO_COST, GOO_PRICE, GOO_STOCK, GOO_CGICODE) VALUES ('00003GI003', '빵', '1500', '2000', '10', 'GI');

-- 4. ORDERS(ORD)
CREATE TABLE ORDERS(
  ORD_EMPCODE   NCHAR(5)    NOT NULL,
  ORD_DATE      DATE        DEFAULT SYSDATE NOT NULL,
  ORD_STATE     NCHAR(2)
)TABLESPACE USERS;

  -- CONSTRAINTS
  ALTER TABLE ORDERS
  ADD CONSTRAINT ORD_EMPCODE_DATE_PK    PRIMARY KEY(ORD_EMPCODE, ORD_DATE)
  ADD CONSTRAINT ORD_STATE_FK   FOREIGN KEY(ORD_STATE) REFERENCES CATEGORYITEM(CGI_CODE);
  
  -- SYNONYM
  CREATE PUBLIC SYNONYM ORD FOR ORDERS;
  
  -- DATA
  
  
-- 5. ORDERSDETAILS(ODT)
CREATE TABLE ORDERDETAILS(
  ODT_ORDEMPCODE    NCHAR(5)    NOT NULL,
  ODT_ORDDATE       DATE        NOT NULL,
  ODT_GOOCODE       NCHAR(10)   NOT NULL,
  ODT_QUANTITY      NUMBER(3,0) DEFAULT 1 NOT NULL
)TABLESPACE USERS;

  -- CONSTRAINTS
  ALTER TABLE ORDERDETAILS
  ADD CONSTRAINT ODT_ORDEMPCODE_DATE_GOOCODE_PK  PRIMARY KEY(ODT_ORDEMPCODE, ODT_ORDDATE, ODT_GOOCODE)
  ADD CONSTRAINT ODT_ORDEMPCODE_ORDDATE_FK  FOREIGN KEY(ODT_ORDEMPCODE, ODT_ORDDATE) REFERENCES ORDERS(ORD_EMPCODE, ORD_DATE)
  ADD CONSTRAINT ODT_GOOCODE_FK     FOREIGN KEY(ODT_GOOCODE)    REFERENCES GOODS(GOO_CODE);
  
  -- SYNONYM
  CREATE PUBLIC SYNONYM ODT FOR ORDERDETAILS;
  
  -- DATA
  
  
-- 6. POINTS(POI)
CREATE TABLE POINTS(
  POI_ORDEMPCODE    NCHAR(5)    NOT NULL,
  POI_ORDDATE       DATE        NOT NULL,
  POI_MEMCODE       NCHAR(5)    NOT NULL,
  POI_AMOUNT        NUMBER(5,0) NOT NULL,
  POI_ACTION        NUMBER(1,0) DEFAULT 1 NOT NULL
)TABLESPACE USERS;

  -- CONSTRAINTS
  ALTER TABLE POINTS
  ADD CONSTRAINT POI_ORDEMPCODE_DATE_MEMCODE_PK    PRIMARY KEY(POI_ORDEMPCODE, POI_ORDDATE, POI_MEMCODE)
  ADD CONSTRAINT POI_ORDEMPCODE_ORDDATE_FK         FOREIGN KEY(POI_ORDEMPCODE, POI_ORDDATE) REFERENCES ORDERS(ORD_EMPCODE, ORD_DATE)
  ADD CONSTRAINT POI_MEMCODE_FK     FOREIGN KEY(POI_MEMCODE) REFERENCES MEMBERS(MEM_CODE);
  
  -- SYNONYM
  CREATE PUBLIC SYNONYM POI FOR POINTS;

  -- DATA
  
-- 9. ACCESSINFO VIEW
CREATE OR REPLACE VIEW  ACCESSINFO AS
SELECT  EMP.EMP_CODE AS EMPLOYEECODE,
               EMP.EMP_NAME AS EMPLPYEENAME,
               TO_CHAR(MAX(AHT.AHT_DATE),'YYYY-MM-DD HH24:MI:SS') AS ACCESSTIME,
               EMP.EMP_LEVEL AS EMPLOYEELEVEL
FROM EMP INNER JOIN AHT ON EMP.EMP_CODE = AHT.AHT_EMPCODE
GROUP BY EMP.EMP_CODE, EMP.EMP_NAME, EMP.EMP_LEVEL;

-- 10. GOODSINFO VIEW
CREATE OR REPLACE VIEW  GOODSINFO AS
SELECT  GOO.GOO_CODE AS GOCODE,
               GOO.GOO_NAME AS GONAME,
               CGI.CGI_CODE AS CACODE,
               CGI.CGI_NAME AS CANAME,
               GOO.GOO_COST AS GOCOST,
               GOO.GOO_PRICE AS GOPRICE,
               GOO.GOO_STOCK AS GOSTOCK
FROM GOO INNER JOIN CGI ON GOO.GOO_CGICODE = CGI.CGI_CODE;

-- 11. GOODSSALESINFO VIEW 
    --총매출
CREATE OR REPLACE VIEW GOODSSALESINFO AS
SELECT   COALESCE(ODT_GOOCODE, GOO_CODE) AS GOCODE,
                COALESCE(TO_CHAR(ODT_ORDDATE,'YYYYMMDD'),'00000000') AS ODDATE,
                GOO_NAME AS GONAME,
                COALESCE(ODT_QUANTITY,0) AS QUANTITY,
                GOO_PRICE AS GOPRICE,
                GOO_COST AS GOCOST
FROM ODT RIGHT OUTER JOIN GOO ON ODT_GOOCODE = GOO_CODE;

    -- 금월매출 
SELECT   GOCODE,
                GONAME,
                ODDATE,
                SUM(GOPRICE*QUANTITY) AS DDSALES,
                SUM((GOPRICE-GOCOST)*QUANTITY) AS PROFIT
FROM GOODSSALESINFO
WHERE GOCODE = '00003GS001' AND SUBSTR(ODDATE,0,6) = TO_CHAR(SYSDATE,'YYYYMM')    
GROUP BY GOCODE,GONAME,ODDATE;